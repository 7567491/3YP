2024-12-11 11:03:42,180 - src.utils - INFO - 正在提取PDF文本...
2024-12-11 11:03:50,063 - src.utils - INFO - 正在处理文本...
2024-12-11 11:03:50,064 - src.utils - INFO - 正在处理第1个文本块...
2024-12-11 11:03:56,428 - src.utils - ERROR - 处理过程中出现错误: LLM处理失败: 401 Client Error: Unauthorized for url: https://api.moonshot.cn/v1/chat/completions
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 35, in process_chunk
    response.raise_for_status()
  File "D:\Python 312\Lib\site-packages\requests\models.py", line 1021, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://api.moonshot.cn/v1/chat/completions

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 34, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 39, in process_chunk
    raise Exception(f"LLM处理失败: {str(e)}")
Exception: LLM处理失败: 401 Client Error: Unauthorized for url: https://api.moonshot.cn/v1/chat/completions
2024-12-11 11:05:13,234 - src.utils - INFO - [32m正在提取PDF文本...[0m
2024-12-11 11:05:21,296 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:05:21,298 - src.utils - INFO - [32m正在处理第1个文本块...[0m
2024-12-11 11:05:21,610 - src.utils - ERROR - [31m处理过程中出现错误: API认证失败，请检查API密钥[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 34, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 43, in process_chunk
    raise Exception("API认证失败，请检查API密钥")
Exception: API认证失败，请检查API密钥
2024-12-11 11:21:49,768 - src.utils - INFO - [32m正在提取PDF文本...[0m
2024-12-11 11:21:57,633 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:21:57,634 - src.utils - INFO - [32m正在处理第1个文本块...[0m
2024-12-11 11:22:36,006 - src.utils - INFO - [32m正在处理第2个文本块...[0m
2024-12-11 11:23:32,339 - src.utils - ERROR - [31m处理过程中出现错误: 响应解析失败: Expecting value: line 1 column 1 (char 0)[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 86, in _parse_response
    return json.loads(content)
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 38, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 60, in process_chunk
    return self._parse_response(response.json())
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 88, in _parse_response
    raise Exception(f"响应解析失败: {str(e)}")
Exception: 响应解析失败: Expecting value: line 1 column 1 (char 0)
2024-12-11 11:24:39,575 - src.utils - INFO - [32m正在提取PDF文本...[0m
2024-12-11 11:24:47,505 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:24:47,507 - src.utils - INFO - [32m正在处理第1个文本块...[0m
2024-12-11 11:26:31,796 - src.utils - INFO - [32m正在提取PDF文本...[0m
2024-12-11 11:27:11,444 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:27:11,594 - src.utils - INFO - [32m正在处理第1个文本块...[0m
2024-12-11 11:27:49,998 - src.utils - INFO - [32m正在处理第2个文本块...[0m
2024-12-11 11:28:44,667 - src.utils - ERROR - [31m处理过程中出现错误: JSON解析失败: Expecting value: line 131 column 14 (char 2193)[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 116, in _parse_response
    data = json.loads(content)
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 131 column 14 (char 2193)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 52, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 74, in process_chunk
    parsed_data = self._parse_response(response.json())
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 127, in _parse_response
    raise Exception(f"JSON解析失败: {str(e)}")
Exception: JSON解析失败: Expecting value: line 131 column 14 (char 2193)
2024-12-11 11:29:59,927 - src.utils - INFO - [32m使用已提取的文本...[0m
2024-12-11 11:29:59,928 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:30:00,076 - src.utils - INFO - [32m跳过已处理的文本块 1[0m
2024-12-11 11:30:00,233 - src.utils - INFO - [32m正在处理第2个文本块...[0m
2024-12-11 11:32:25,821 - src.utils - ERROR - [31m处理过程中出现错误: JSON解析失败: Expecting ',' delimiter: line 129 column 5 (char 2826)[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 167, in _parse_response
    data = json.loads(content)
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 131 column 20 (char 2883)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 174, in _parse_response
    data = json.loads(fixed_content)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python 312\Lib\json\decoder.py", line 353, in raw_decode
    obj, end = self.scan_once(s, idx)
               ^^^^^^^^^^^^^^^^^^^^^^
json.decoder.JSONDecodeError: Expecting ',' delimiter: line 129 column 5 (char 2826)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 52, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 91, in process_chunk
    parsed_data = self._parse_response(response.json())
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 194, in _parse_response
    raise Exception(f"JSON解析失败: {str(e)}")
Exception: JSON解析失败: Expecting ',' delimiter: line 129 column 5 (char 2826)
2024-12-11 11:34:51,058 - src.utils - INFO - [32m使用已提取的文本...[0m
2024-12-11 11:34:51,058 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:34:51,206 - src.utils - INFO - [32m跳过已处理的文本块 1[0m
2024-12-11 11:34:51,363 - src.utils - INFO - [32m正在处理第2个文本块...[0m
2024-12-11 11:35:50,476 - src.utils - ERROR - [31m处理过程中出现错误: '\n    "财务数据和指标"'[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 52, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 48, in process_chunk
    messages=self._format_messages(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 102, in _format_messages
    message["content"] = message["content"].format(**kwargs)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: '\n    "财务数据和指标"'
2024-12-11 11:36:46,708 - src.utils - INFO - [32m使用已提取的文本...[0m
2024-12-11 11:36:46,708 - src.utils - INFO - [32m正在处理文本...[0m
2024-12-11 11:36:46,859 - src.utils - INFO - [32m跳过已处理的文本块 1[0m
2024-12-11 11:36:47,014 - src.utils - INFO - [32m正在处理第2个文本块...[0m
2024-12-11 11:37:48,383 - src.utils - ERROR - [31m处理过程中出现错误: '"type"'[0m
Traceback (most recent call last):
  File "D:\0\Six\3YP\3YP\financial_report_parser\main.py", line 52, in main
    chunk_data = llm_processor.process_chunk(chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 47, in process_chunk
    messages=self._format_messages(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\0\Six\3YP\3YP\financial_report_parser\src\llm_processor.py", line 101, in _format_messages
    message["content"] = message["content"].format(**kwargs)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: '"type"'
